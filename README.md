Perfume Bot MVP

–ë–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–∞—Ä—Ñ—é–º–æ–≤ –∏ –∏—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–ª–æ–Ω–æ–≤ —Å —Ä–∞—Å—á–µ—Ç–æ–º —ç–∫–æ–Ω–æ–º–∏–∏.

**–ö–ª—é—á–µ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ **PostgreSQL** –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –æ–±–ª–∞—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, Render) –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

perfume-bot/
‚îÇ
‚îú‚îÄ‚îÄ web.py         \# –ó–∞–ø—É—Å–∫ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram, –≤–∫–ª—é—á–∞—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ database.py    \# –†–∞–±–æ—Ç–∞ —Å PostgreSQL –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü üëà
‚îú‚îÄ‚îÄ search.py      \# –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –≥–∏–±–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–±—Ä–µ–Ω–¥/–Ω–∞–∑–≤–∞–Ω–∏–µ, fuzzy)
‚îú‚îÄ‚îÄ formatter.py   \# –°–±–æ—Ä–∫–∞ –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
‚îú‚îÄ‚îÄ followup.py    \# –õ–æ–≥–∏–∫–∞ "–£—Ä–∞\! üéâ..." (–æ—Ç–ø—Ä–∞–≤–∫–∞ 1 —Ä–∞–∑)
‚îú‚îÄ‚îÄ utils.py       \# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞, —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ i18n.py        \# –§–∞–π–ª –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç
‚îú‚îÄ‚îÄ analyze\_db.py  \# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env

````

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä–µ—Ö** –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

### 1. –¢–∞–±–ª–∏—Ü–∞ `UserMessages` (–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫.

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `id` | `SERIAL PRIMARY KEY` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π id |
| `user_id` | `BIGINT` | Telegram user ID |
| `timestamp` | `TIMESTAMP WITH TIME ZONE` | –í—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏—è |
| `message` | `TEXT` | –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è |
| `status` | `TEXT` | –°—Ç–∞—Ç—É—Å (e.g., `success`, `fail`, `start_command`) |
| `notes` | `TEXT` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è (e.g., Fuzzy Match, –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏) |

### 2. –¢–∞–±–ª–∏—Ü–∞ `OriginalPerfume` (–û—Ä–∏–≥–∏–Ω–∞–ª—ã)

–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–æ—Ä–æ–≥–∏—Ö –ø–∞—Ä—Ñ—é–º–∞—Ö.

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `id` | `TEXT PRIMARY KEY` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (Primary Key) |
| `brand` | `TEXT` | –ë—Ä–µ–Ω–¥ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ |
| `name` | `TEXT` | –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ |
| `price_eur` | `REAL` | –¶–µ–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –≤ –µ–≤—Ä–æ |
| `url` | `TEXT` | –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ |

### 3. –¢–∞–±–ª–∏—Ü–∞ `CopyPerfume` (–ö–ª–æ–Ω—ã/–ê–Ω–∞–ª–æ–≥–∏)

–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ø–∏—è—Ö –ø–∞—Ä—Ñ—é–º–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º.

| –ö–æ–ª–æ–Ω–∫–∞ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `id` | `TEXT PRIMARY KEY` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π id (Primary Key) |
| `original_id` | `TEXT` | –°—Å—ã–ª–∫–∞ –Ω–∞ `id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `OriginalPerfume` (`FOREIGN KEY`) |
| `brand` | `TEXT` | –ë—Ä–µ–Ω–¥ –∫–ª–æ–Ω–∞ |
| `name` | `TEXT` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–æ–Ω–∞ |
| `price_eur` | `REAL` | –¶–µ–Ω–∞ –∫–ª–æ–Ω–∞ –≤ –µ–≤—Ä–æ |
| `url` | `TEXT` | –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª–æ–Ω |
| `notes` | `TEXT` | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –∞—Ä–æ–º–∞—Ç—É |
| `saved_amount` | `REAL` | –≠–∫–æ–Ω–æ–º–∏—è –≤ %: `(orig_price_eur - dupe_price_eur) / orig_price_eur * 100` |

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1.  **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —É–∫–∞–∂–∏—Ç–µ **–≤—Å–µ** –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

    ```
    # --- –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê ---
    BOT_TOKEN="–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨"
    WEBHOOK_URL="–í–ê–®_WEBHOOK_URL_–ù–ê_RENDER"
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ø–∑—ã–∫ –±–æ—Ç–∞ (ru –∏–ª–∏ en). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ru.
    BOT_LANG="ru"

    # --- –ù–ê–°–¢–†–û–ô–ö–ò POSTGRESQL ---
    # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Render.
    DATABASE_URL="postgresql://perfume_bot_public_posgresql_user:kIlMPx2gsC9uACxwMMk5KckZ4WaOsWit@dpg-d3c11k2li9vc73d6lee0-a/perfume_bot_public_posgresql"
    ```

3.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
    –î–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫ –Ω–∞ Render –≤–∞–º, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è `gunicorn` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π WSGI-—Å–µ—Ä–≤–µ—Ä.

    ```bash
    gunicorn web:app
    ```

---

## üî¨ –ê–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª **`analyze_db.py`** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

1.  **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DATABASE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** (—Å–º. –≤—ã—à–µ).
2.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:**

    ```bash
    python analyze_db.py
    ```

    –°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç:
    * –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –û—Ä–∏–≥–∏–Ω–∞–ª–æ–≤ –∏ –ö–ª–æ–Ω–æ–≤.
    * 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ñ—é–º–æ–≤.
    * 5 –∫–ª–æ–Ω–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π —ç–∫–æ–Ω–æ–º–∏–µ–π.
    * –û–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`success`, `fail`, `start_command`).
    * 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö **–Ω–µ—É–¥–∞—á–Ω—ã—Ö** –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞, —á—Ç–æ –Ω–µ –Ω–∞—à—ë–ª –±–æ—Ç.
    * 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö **—É—Å–ø–µ—à–Ω—ã—Ö, –Ω–æ –Ω–µ—Ç–æ—á–Ω—ã—Ö** –∑–∞–ø—Ä–æ—Å–æ–≤ (Fuzzy Match).
````